{% extends "base.html" %}

{% block title %}Edit Product - FreshConnect{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">Edit Product</h4>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('vendor.edit_product', product_id=product.id) }}" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="product_name" class="form-label">Product Name *</label>
                                <input type="text" class="form-control" id="product_name" name="product_name" value="{{ product.product_name }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="category" class="form-label">Category *</label>
                                <select class="form-select" id="category" name="category" required>
                                    <option value="Vegetables" {% if product.category == 'Vegetables' %}selected{% endif %}>Vegetables</option>
                                    <option value="Fruits" {% if product.category == 'Fruits' %}selected{% endif %}>Fruits</option>
                                    <option value="Grains" {% if product.category == 'Grains' %}selected{% endif %}>Grains</option>
                                    <option value="Dairy" {% if product.category == 'Dairy' %}selected{% endif %}>Dairy</option>
                                    <option value="Spices" {% if product.category == 'Spices' %}selected{% endif %}>Spices</option>
                                    <option value="Flowers" {% if product.category == 'Flowers' %}selected{% endif %}>Flowers</option>
                                    <option value="Packaged" {% if product.category == 'Packaged' %}selected{% endif %}>Packaged Goods</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3">{{ product.description or '' }}</textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="price" class="form-label">Price (â‚¹) *</label>
                                <input type="number" step="0.01" class="form-control" id="price" name="price" value="{{ product.price }}" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="quantity" class="form-label">Quantity *</label>
                                <input type="number" class="form-control" id="quantity" name="quantity" value="{{ product.quantity }}" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="unit" class="form-label">Unit *</label>
                                <select class="form-select" id="unit" name="unit" required>
                                    <option value="kg" {% if product.unit == 'kg' %}selected{% endif %}>Kilogram (kg)</option>
                                    <option value="liter" {% if product.unit == 'liter' %}selected{% endif %}>Liter</option>
                                    <option value="piece" {% if product.unit == 'piece' %}selected{% endif %}>Piece</option>
                                    <option value="dozen" {% if product.unit == 'dozen' %}selected{% endif %}>Dozen</option>
                                    <option value="gram" {% if product.unit == 'gram' %}selected{% endif %}>Gram</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="expiry_date" class="form-label">Expiry Date</label>
                                <input type="date" class="form-control" id="expiry_date" name="expiry_date" value="{{ product.expiry_date.strftime('%Y-%m-%d') if product.expiry_date else '' }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="image" class="form-label">Update Image</label>
                                <input type="file" class="form-control" id="image" name="image" accept="image/*">
                                {% if product.image_filename %}
                                <small class="text-muted">Current: {{ product.image_filename }}</small>
                                {% endif %}
                            </div>
                        </div>

                        <hr class="my-4">

                        <h5 class="mb-3">MOQ Settings</h5>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="moq_enabled" name="moq_enabled" {% if product.moq_enabled %}checked{% endif %} onchange="toggleMOQ()">
                            <label class="form-check-label" for="moq_enabled">
                                Enable Minimum Order Quantity
                            </label>
                        </div>

                        <div id="moq_settings" style="display: {% if product.moq_enabled %}block{% else %}none{% endif %};">
                            <div class="mb-3">
                                <label for="moq_type" class="form-label">MOQ Type</label>
                                <select class="form-select" id="moq_type" name="moq_type" onchange="updateMOQFields()">
                                    <option value="quantity" {% if product.moq_type == 'quantity' %}selected{% endif %}>Quantity-based</option>
                                    <option value="weight" {% if product.moq_type == 'weight' %}selected{% endif %}>Weight-based</option>
                                    <option value="both" {% if product.moq_type == 'both' %}selected{% endif %}>Both</option>
                                </select>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3" id="min_qty_field">
                                    <label for="minimum_quantity" class="form-label">Minimum Quantity</label>
                                    <input type="number" class="form-control" id="minimum_quantity" name="minimum_quantity" value="{{ product.minimum_quantity or '' }}">
                                </div>
                                <div class="col-md-6 mb-3" id="min_weight_field">
                                    <label for="minimum_weight" class="form-label">Minimum Weight (kg)</label>
                                    <input type="number" step="0.01" class="form-control" id="minimum_weight" name="minimum_weight" value="{{ product.minimum_weight or '' }}">
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save"></i> Update Product
                            </button>
                            <a href="{{ url_for('vendor.products') }}" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleMOQ() {
    const enabled = document.getElementById('moq_enabled').checked;
    document.getElementById('moq_settings').style.display = enabled ? 'block' : 'none';
    if (enabled) {
        updateMOQFields();
    }
}

function updateMOQFields() {
    const type = document.getElementById('moq_type').value;
    const qtyField = document.getElementById('min_qty_field');
    const weightField = document.getElementById('min_weight_field');
    
    if (type === 'quantity') {
        qtyField.style.display = 'block';
        weightField.style.display = 'none';
    } else if (type === 'weight') {
        qtyField.style.display = 'none';
        weightField.style.display = 'block';
    } else {
        qtyField.style.display = 'block';
        weightField.style.display = 'block';
    }
}

// Initialize on load
updateMOQFields();
</script>
{% endblock %}
