{% extends "base.html" %}

{% block title %}Add Product - FreshConnect{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">Add New Product</h4>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('vendor.add_product') }}" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="product_name" class="form-label">Product Name *</label>
                                <input type="text" class="form-control" id="product_name" name="product_name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="category" class="form-label">Category *</label>
                                <select class="form-select" id="category" name="category" required>
                                    <option value="">Select Category</option>
                                    <option value="Vegetables">Vegetables</option>
                                    <option value="Fruits">Fruits</option>
                                    <option value="Grains">Grains</option>
                                    <option value="Dairy">Dairy</option>
                                    <option value="Spices">Spices</option>
                                    <option value="Flowers">Flowers</option>
                                    <option value="Packaged">Packaged Goods</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3"></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="price" class="form-label">Price (₹) *</label>
                                <input type="number" step="0.01" class="form-control" id="price" name="price" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="quantity" class="form-label">Quantity *</label>
                                <input type="number" class="form-control" id="quantity" name="quantity" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="unit" class="form-label">Unit *</label>
                                <select class="form-select" id="unit" name="unit" required>
                                    <option value="kg">Kilogram (kg)</option>
                                    <option value="liter">Liter</option>
                                    <option value="piece">Piece</option>
                                    <option value="dozen">Dozen</option>
                                    <option value="gram">Gram</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="expiry_date" class="form-label">Expiry Date</label>
                                <input type="date" class="form-control" id="expiry_date" name="expiry_date">
                                <small class="text-muted">Products expiring in ≤3 days get automatic emergency discounts</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="image" class="form-label">Product Image</label>
                                <input type="file" class="form-control" id="image" name="image" accept="image/*">
                                <small class="text-muted">Max 5MB (jpg, png, gif)</small>
                            </div>
                        </div>

                        <hr class="my-4">

                        <h5 class="mb-3">Minimum Order Quantity (MOQ) Settings</h5>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="moq_enabled" name="moq_enabled" onchange="toggleMOQ()">
                            <label class="form-check-label" for="moq_enabled">
                                Enable Minimum Order Quantity
                            </label>
                        </div>

                        <div id="moq_settings" style="display: none;">
                            <div class="mb-3">
                                <label for="moq_type" class="form-label">MOQ Type</label>
                                <select class="form-select" id="moq_type" name="moq_type" onchange="updateMOQFields()">
                                    <option value="quantity">Quantity-based (e.g., minimum 100 units)</option>
                                    <option value="weight">Weight-based (e.g., minimum 50kg)</option>
                                    <option value="both">Both (quantity AND weight)</option>
                                </select>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3" id="min_qty_field">
                                    <label for="minimum_quantity" class="form-label">Minimum Quantity</label>
                                    <input type="number" class="form-control" id="minimum_quantity" name="minimum_quantity">
                                </div>
                                <div class="col-md-6 mb-3" id="min_weight_field" style="display: none;">
                                    <label for="minimum_weight" class="form-label">Minimum Weight (kg)</label>
                                    <input type="number" step="0.01" class="form-control" id="minimum_weight" name="minimum_weight">
                                </div>
                            </div>

                            <div class="alert alert-info">
                                <small>
                                    <i class="fas fa-info-circle"></i>
                                    MOQ helps you maintain profitability by setting minimum order requirements. 
                                    Retailers will be notified if their order doesn't meet the minimum.
                                </small>
                            </div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="fas fa-plus"></i> Add Product
                            </button>
                            <a href="{{ url_for('vendor.products') }}" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleMOQ() {
    const enabled = document.getElementById('moq_enabled').checked;
    document.getElementById('moq_settings').style.display = enabled ? 'block' : 'none';
    if (enabled) {
        updateMOQFields();
    }
}

function updateMOQFields() {
    const type = document.getElementById('moq_type').value;
    const qtyField = document.getElementById('min_qty_field');
    const weightField = document.getElementById('min_weight_field');
    
    if (type === 'quantity') {
        qtyField.style.display = 'block';
        weightField.style.display = 'none';
    } else if (type === 'weight') {
        qtyField.style.display = 'none';
        weightField.style.display = 'block';
    } else {
        qtyField.style.display = 'block';
        weightField.style.display = 'block';
    }
}
</script>
{% endblock %}
