{% extends "base.html" %}

{% block title %}My Orders - FreshConnect{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">My Orders</h2>

    {% if orders %}
    <div class="row g-4">
        {% for order in orders %}
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h5 class="card-title">Order #{{ order.order_id }}</h5>
                            <p class="text-muted mb-2">Placed on {{ order.created_at.strftime('%d %b %Y at %H:%M') }}</p>
                            
                            <div class="mb-3">
                                <h6>Items:</h6>
                                {% for item in order.items %}
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div>
                                        <strong>{{ item.product.product_name }}</strong>
                                        <br>
                                        <small class="text-muted">
                                            {{ item.quantity }} {{ item.product.unit }} × ₹{{ "%.2f"|format(item.price_at_purchase) }}
                                        </small>
                                    </div>
                                    <div>
                                        ₹{{ "%.2f"|format(item.subtotal) }}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>

                            <div class="mb-2">
                                <strong>Delivery Address:</strong><br>
                                {{ order.delivery_address }}, {{ order.delivery_city }} - {{ order.delivery_pincode }}
                            </div>
                        </div>

                        <div class="col-md-4 text-end">
                            <div class="mb-3">
                                {% if order.status == 'pending' %}
                                <span class="badge bg-warning fs-6">Pending</span>
                                {% elif order.status == 'confirmed' %}
                                <span class="badge bg-success fs-6">Confirmed</span>
                                {% elif order.status == 'processing' %}
                                <span class="badge bg-info fs-6">Processing</span>
                                {% elif order.status == 'shipped' %}
                                <span class="badge bg-primary fs-6">Shipped</span>
                                {% elif order.status == 'delivered' %}
                                <span class="badge bg-success fs-6">Delivered</span>
                                {% endif %}
                            </div>

                            <div class="mb-3">
                                {% if order.payment_status == 'paid' %}
                                <span class="badge bg-success">Payment: Paid</span>
                                {% elif order.payment_status == 'pending' %}
                                <span class="badge bg-warning">Payment: Pending</span>
                                {% else %}
                                <span class="badge bg-danger">Payment: Failed</span>
                                {% endif %}
                            </div>

                            <h4 class="text-success mb-3">₹{{ "%.2f"|format(order.total_amount) }}</h4>

                            <a href="{{ url_for('retailer.order_detail', order_id=order.id) }}" class="btn btn-outline-primary">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info text-center">
        <h4><i class="fas fa-box-open"></i> No orders yet</h4>
        <p>Start shopping to place your first order!</p>
        <a href="{{ url_for('retailer.browse') }}" class="btn btn-success">
            <i class="fas fa-shopping-bag"></i> Browse Products
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
